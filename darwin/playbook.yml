---
- hosts: all
  gather_facts: yes

  pre_tasks:
    - name: Install homebrew
      shell: /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"

    - name: brew tap {{ item }}
      homebrew_tap: tap={{ item }} state=present
      with_items:
        - homebrew/versions
        - homebrew/dupes
        - homebrew/binary
        - homebrew/completions
        - caskroom/versions
        - caskroom/cask
        - homebrew/php

  tasks:
    - name: Install brew packages
      homebrew: name={{ item }} state=present
      with_items:
        - autojump
        - bash
        - bash-completion2
        - chromedriver
        - csshx
        - ctags
        - dialog
        - git
        - git-extras
        - htop
        - jq
        - launchctl-completion
        - mas
        - mobile-shell
        - mtr
        - multitail
        - nano
        - ncdu
        - node
        - packer
        - packer-completion
        - php56
        - php-code-sniffer
        - pngquant
        - python
        - python3
        - rbenv
        - ruby-build
        - selenium-server-standalone
        - tmux
        - tmux-cssh
        - vagrant-completion
        - trash
        - tree
        - watch
        - wget

    - name: Install from appstore
      shell: mas install {{ item }}
      with_items:
        - 425424353
        - 408981434
        - 406056744
        - 443987910
        - 524373870
        - 557168941
        - 419330170
        - 458034879
        - 880001334
        - 1039633667

    - name: Install from cask
      homebrew_cask: name={{ item }} state=present
      with_items:
        - adium
        - adobe-creative-cloud
        - alfred
        - cleanapp
        - controlplane
        - dropbox
        - firefox
        - firefoxdeveloperedition
        - flux
        - google-chrome
        - google-chrome-canary
        - hipchat
        - iterm2
        - istat-menus
        - karabiner
        - kobo
        - logitech-options
        - macdown
        - opera
        - opera-developer
        - sequel-pro
        - slack
        - spotify
        - tomtom-mysports-connect
        - torbrowser
        - transmit
        - vlc
        - virtualbox
        - whatsapp

    - name: Install pip packages
      pip: executable=pip3 name={{ item }} state=latest
      with_items:
        - icdiff
        - virtualenv

    - name: Install older pylint
      pip: executable=pip3 name=pylint version=1.5.6

    - name: Install npm packages
      npm: name={{ item }} global=yes
      with_items:
        - npm
        - tldr

  post_tasks:
    - name: Link darwin based dotfiles
      file: src=~/.dotfiles/darwin/symlinks/{{ item }} dest=~/.{{ item }} state=link
      with_items:
        - aliases
        - bash_profile

    - name: Link general dotfiles
      file: src=~/.dotfiles/symlinks/{{ item }} dest=~/.{{ item }} state=link
      with_items:
        - bash_prompt
        - functions
        - gitconfig
        - gitignore
        - jshintrc
        - nanorc
        - pylintrc

  #   - file: src=~/Dropbox/system/dotfiles/symlinks/{{ item }} dest=~/.{{ item }} state=link
  #     with_items:
  #       - hosts
  #       - ssh

  #   - file: src="~/Dropbox/system/Library/{{ item }}" dest=~/Library/Application{{' '}}Support/{{ item }} state=link
  #     with_items:
  #       - "Adium{{' '}}2.0"
  #       - "Alfred{{' '}}3"
